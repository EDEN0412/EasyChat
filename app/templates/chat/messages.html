{% extends "base.html" %}

{% block content %}
<div class="chat-container">
    <div class="messages-area">
        {% for message in messages %}
        <div class="message {% if message.user_id == session.get('user_id') %}message-own{% endif %}">
            <div class="message-header">
                <span class="username">{{ message.author.username }}</span>
                <span class="timestamp">
                    {{ message.created_at.strftime('%Y-%m-%d %H:%M') }}
                    {% if message.is_edited %}
                    <span class="edited-mark">（編集済み）</span>
                    {% endif %}
                </span>
            </div>
            <div class="message-content" id="message-content-{{ message.id }}">
                {{ message.content }}
            </div>
            {% if message.user_id == session.get('user_id') %}
            <div class="message-actions">
                <button onclick="showEditForm('{{ message.id }}')" class="btn-action">編集</button>
                <form action="{{ url_for('chat.delete_message', message_id=message.id) }}" method="POST" class="delete-form">
                    <button type="submit" class="btn-action btn-delete" onclick="return confirm('本当に削除しますか？')">削除</button>
                </form>
            </div>
            <div class="edit-form" id="edit-form-{{ message.id }}" style="display: none;">
                <form action="{{ url_for('chat.edit_message', message_id=message.id) }}" method="POST">
                    <input type="text" name="content" value="{{ message.content }}" required>
                    <button type="submit" class="btn-action">保存</button>
                    <button type="button" class="btn-action" onclick="hideEditForm('{{ message.id }}')">キャンセル</button>
                </form>
            </div>
            {% endif %}
        </div>
        {% endfor %}
    </div>
    
    <div class="message-form">
        <form method="POST" action="{{ url_for('chat.send_message') }}">
            <div class="form-group">
                <input type="text" id="message" name="message" required placeholder="メッセージを入力...">
                <button type="submit">送信</button>
            </div>
        </form>
    </div>
</div>

<script>
function showEditForm(messageId) {
    document.getElementById('message-content-' + messageId).style.display = 'none';
    document.getElementById('edit-form-' + messageId).style.display = 'block';
}

function hideEditForm(messageId) {
    document.getElementById('message-content-' + messageId).style.display = 'block';
    document.getElementById('edit-form-' + messageId).style.display = 'none';
}
</script>
{% endblock %} 